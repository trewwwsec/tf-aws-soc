# AI Alert Analyst Configuration
# Copy to settings.yaml and customize

# AI Provider Settings
ai:
  # Provider: openai, anthropic, or ollama
  provider: "openai"
  
  # Model selection
  openai_model: "gpt-4"
  anthropic_model: "claude-3-sonnet-20240229"
  ollama_model: "llama2"
  
  # Generation parameters
  temperature: 0.3
  max_tokens: 2000

# Wazuh API Settings
wazuh:
  host: "localhost"
  port: 55000
  user: "wazuh-api"
  # Password should be set via WAZUH_PASSWORD env var
  ssl_verify: false

# Enrichment Settings
enrichment:
  # Enable threat intelligence lookups
  enable_threat_intel: true
  
  # Enable IP geolocation
  enable_geolocation: true
  
  # Enable historical event analysis
  enable_historical: true
  
  # Hours to look back for historical events
  historical_hours: 24
  
  # Threat intel sources (requires API keys)
  threat_intel_sources:
    - abuseipdb
    - virustotal

# Output Settings
output:
  # Format: terminal, json, markdown
  format: "terminal"
  
  # Include raw alert data in output
  include_raw_alert: false
  
  # Include AI recommendations
  include_recommendations: true
  
  # Color output for terminal
  use_colors: true

# Logging Settings
logging:
  level: "INFO"
  file: "logs/ai-analyst.log"
  max_size_mb: 10
  backup_count: 5

# Alert Processing Settings
processing:
  # Minimum severity level to process (0-15)
  min_level: 5
  
  # Rule IDs to always analyze (even if below min_level)
  priority_rules:
    - "100001"  # SSH brute force
    - "100013"  # Mimikatz
    - "100070"  # Shadow file access
    - "100071"  # LSASS access
  
  # Rule IDs to skip analysis
  skip_rules: []

# Playbook Mapping
playbooks:
  base_path: "../incident-response/playbooks"
  
  # Automatic playbook selection based on attack type
  attack_type_mapping:
    brute_force: "ssh-brute-force.md"
    credential_theft: "credential-dumping.md"
    privilege_escalation: "privilege-escalation.md"
    persistence: "persistence.md"
    default: "general-incident.md"

# API Server Settings (for REST API mode)
api:
  host: "0.0.0.0"
  port: 8080
  enable_cors: true
  require_auth: false
  # auth_token: "set-via-env-var"

# Anomaly Detection Settings
anomaly_detection:
  enabled: true

  # How often to scan in monitor mode (seconds)
  scan_interval_seconds: 300

  # How far back to look for events
  lookback_hours: 24

  # Baseline persistence file
  baseline_file: "baselines/agent_baselines.json"

  # Z-score threshold for flagging deviations
  # Lower = more sensitive (more alerts), Higher = less sensitive
  z_score_threshold: 2.5

  # Minimum AI confidence score to include a finding
  min_confidence: 0.6

  # Detection categories to enable
  categories:
    login_anomalies: true
    process_anomalies: true
    network_anomalies: true
    privilege_anomalies: true
    file_integrity_anomalies: true
    volume_anomalies: true

# RAG (Retrieval-Augmented Generation) Settings
rag:
  enabled: true

  # Embedding model configuration
  embedding:
    # Model name for sentence-transformers
    # Options: "all-MiniLM-L6-v2" (384d, fast), "all-mpnet-base-v2" (768d, higher quality)
    model: "all-MiniLM-L6-v2"
    
    # Cache directory for model and embeddings
    cache_dir: "~/.cache/ai-analyst/embeddings"

  # OpenSearch configuration for vector storage
  opensearch:
    # Connection settings (can also use env vars: OPENSEARCH_HOST, OPENSEARCH_PASSWORD)
    host: "localhost"
    port: 9200
    username: "admin"
    # password: "set-via-env-var"
    use_ssl: true
    verify_certs: false

  # Retrieval configuration
  retrieval:
    # Minimum similarity score (0-1) for results to be considered relevant
    similarity_threshold: 0.7
    
    # Maximum number of results to retrieve per category
    max_similar_alerts: 5
    max_threat_intel: 3
    max_playbooks: 2
    
    # Time range for historical context search
    # Options: "1h", "24h", "7d", "30d"
    time_range: "7d"
    
    # Enable hybrid search (combines text + vector similarity)
    hybrid_search: true
    
    # Weights for hybrid search (must sum to 1.0)
    # text_weight: weight for keyword matching
    # vector_weight: weight for semantic similarity
    text_weight: 0.3
    vector_weight: 0.7

  # Alert indexing
  indexing:
    # Automatically index alerts for future retrieval
    auto_index: true
    
    # Minimum severity level to index (0-15)
    min_level: 5
    
    # Index historical alerts on startup
    index_historical: false
    
    # How far back to index historical alerts
    historical_days: 30

